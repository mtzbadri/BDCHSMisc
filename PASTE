#include <Servo.h>

// ESC/Thruster Settings
const int MAX = 150; // Value between 0-400
const int CENTER = 1500;
const int BUTTON_PRESS_THRESHOLD = 150; // Set your desired value for button press

// Arduino Pins
const byte Joystick1 = A8; // Joystick Y-axis (motor 1)
const byte Joystick2 = A0; // Joystick Z-axis (motor 2)
const byte Joystick3 = A4; // Joystick for motor 3 (new input)
const byte Joystick4 = A4; // Joystick for motor 4 (new input)
const byte Button1 = A4;
const byte Button2 = A4;
const byte Button3 = A8; // New button for motor 1
const byte TH_L = 24;
const byte TH_R = 26;
const byte TH_U = 27; 
const byte TH_D = 25;

// Servos
Servo thL;
Servo thR;
Servo thU;
Servo thD;

void setup() {
  Serial.begin(9600);

  thL.attach(TH_L);
  thR.attach(TH_R);
  thU.attach(TH_U);
  thD.attach(TH_D);

  thL.writeMicroseconds(CENTER);
  thR.writeMicroseconds(CENTER);
  thU.writeMicroseconds(CENTER);
  thD.writeMicroseconds(CENTER);

  delay(2000);
}

void loop() {
  int rawmotor1Command = map(analogRead(Joystick1), 0, 1023, -MAX, MAX);
  int rawmotor2Command = map(analogRead(Joystick2), 0, 1023, -MAX, MAX);
  int rawmotor3Command = map(analogRead(Joystick3), 0, 1023, -MAX, MAX);
  int rawmotor4Command = map(analogRead(Joystick4), 0, 1023, -MAX, MAX);

  int motor1Command = rawmotor1Command;
  int motor2Command = rawmotor2Command;
  int motor3Command = rawmotor3Command;
  int motor4Command = rawmotor4Command;

  // Motor 1 button logic
  if (analogRead(Button3) > BUTTON_PRESS_THRESHOLD) {
    motor1Command = MAX;
  } else if (analogRead(Button3) < BUTTON_PRESS_THRESHOLD) {
    motor1Command = -MAX;
  } else {
    motor1Command = 0;
  }

  // Motor 3 and 4 button logic
  if (analogRead(Button1) > BUTTON_PRESS_THRESHOLD) {
    motor3Command = MAX;
  } else if (analogRead(Button2) > BUTTON_PRESS_THRESHOLD) {
    motor4Command = MAX;
  } else {
    motor3Command = 0;
    motor4Command = 0;
  }

  // Adjust motor commands based on joystick inputs
  if (rawmotor1Command > 600) {
    motor1Command = MAX;
  } else if (rawmotor1Command < 400) {
    motor1Command = -MAX;
  }

  if (rawmotor2Command > 600) {
    motor2Command = MAX;
  } else if (rawmotor2Command < 400) {
    motor2Command = -MAX;
  }

  thL.writeMicroseconds(CENTER + motor1Command);
  thR.writeMicroseconds(CENTER + motor2Command);
  thU.writeMicroseconds(CENTER + motor3Command);
  thD.writeMicroseconds(CENTER + motor4Command);

  Serial.print("Fwd: "); Serial.print(motor1Command);
  Serial.print("    Back: "); Serial.print(motor2Command);
  Serial.print("      ");

  Serial.print("Motor 3: "); Serial.print(motor3Command);
  Serial.print("    Motor 4: "); Serial.println(motor4Command);

  delay(500);
}
